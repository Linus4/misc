# This is an ansible playbook I use to set up my Fedora Workstation.
# Install ansible, get this file, then run `ansible-playbook post_install.yml`.

- hosts: localhost
  tasks:
    - name: Enable RPM Fusion Repos
      become: yes
      # Make sure to use the correct version number! \FIXME
      command: sudo dnf install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-28.noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-28.noarch.rpm -y
    - name: Install htop
      become: yes
      package:
        name: htop
        state: present
    - name: Install tmux
      become: yes
      package:
        name: tmux
        state: present
    - name: Install vim
      become: yes
      package:
        name: vim-enhanced
        state: present
    - name: Install pandoc
      become: yes
      package:
        name: pandoc
        state: present
    - name: Install texlive
      become: yes
      package:
        name: texlive
        state: present
    - name: Install texlive-babel-german
      become: yes
      package:
        name: texlive-babel-german
        state: present
    - name: Install Calibre
      become: yes
      package:
        name: calibre
        state: present
    - name: Install xournal
      become: yes
      package:
        name: xournal
        state: present
    - name: Install keepass
      become: yes
      package:
        name: keepass
        state: present
    - name: Install gnome-tweaks
      become: yes
      package:
        name: gnome-tweaks
        state: present
    - name: Install vlc
      become: yes
      package:
        name: vlc
        state: present
    - name: Install ffmpeg
      become: yes
      package:
        name: ffmpeg
        state: present
    - name: Install youtube-dl
      become: yes
      package:
        name: youtube-dl
        state: present
    - name: Install chrome-gnome-shell
      become: yes
      package:
        name: chrome-gnome-shell
        state: present
    - name: Install dconf-editor
      become: yes
      package:
        name: dconf-editor
        state: present
    - name: Install shell extension dash-to-dock
      become: yes
      package:
        name: gnome-shell-extension-dash-to-dock.noarch
        state: present
    - name: Install shell extension user themes
      become: yes
      package:
        name: gnome-shell-extension-user-theme.noarch
        state: present
    - name: Install streamlink
      become: yes
      command: pip install streamlink
    - name: Install libselinux (dependency for ansible get_url)
      become: yes
      package:
        name: libselinux-python
        state: present

    - name: Enable GNOME Shell Extensions
      dconf:
        key: "/org/gnome/shell/disable-user-extensions"
        value: "false"
    - name: Enable certain GNOME Shell Extensions
      dconf:
        key: "/org/gnome/shell/enabled-extensions"
        value: "['user-theme@gnome-shell-extensions.gcampax.github.com', 'dash-to-dock@micxgx.gmail.com']"
    - name: Shrink Dash-To-Dock
      dconf:
        key: "/org/gnome/shell/extensions/dash-to-dock/custom-theme-shrink"
        value: "true"
    - name: Show weekday in clock
      dconf:
        key: "/org/gnome/desktop/interface/clock-show-date"
        value: "true"
    - name: Show battery percentage
      dconf:
        key: "/org/gnome/desktop/interface/show-battery-percentage"
        value: "true"
    - name: Disable natural scroll
      dconf:
        key: "/org/gnome/desktop/peripherals/mouse/natural-scroll"
        value: "false"
    - name: Disable natural scroll touchpad
      dconf:
        key: "/org/gnome/desktop/peripherals/touchpad/natural-scroll"
        value: "false"
    - name: Enable tap to click touchpad
      dconf:
        key: "/org/gnome/desktop/peripherals/touchpad/tap-to-click"
        value: "true"
    - name: Shell search display order
      dconf:
        key: "/org/gnome/desktop/search-providers/sort-order"
        value: "['org.gnome.Contacts.desktop', 'org.gnome.Documents.desktop', 'org.gnome.Nautilus.desktop']"
    - name: Disable automatic screen lock
      dconf:
        key: "/org/gnome/desktop/session/idle-delay"
        value: "0"
    - name: Window title bar buttons to the left
      dconf: 
        key: "/org/gnome/desktop/wm/preferences/button-layout"
        value: "'close,minimize,maximize:appmenu'"
    - name: Files zoom level
      dconf:
        key: "/org/gnome/nautilus/list-view/default-zoom-level"
        value: "'small'"
    - name: Files column order
      dconf:
        key: "/org/gnome/nautilus/list-view/default-column-order"
        value: "['name', 'size', 'type', 'owner', 'group', 'permissions', 'mime_type', 'where', 'date_modified', 'date_modified_with_time', 'date_accessed', 'recency', 'starred']"
    - name: Files visible columns
      dconf:
        key: "/org/gnome/nautilus/list-view/default-visible-columns"
        value: "['name', 'size', 'date_modified']"
    - name: Files folder viewer
      dconf:
        key: "/org/gnome/nautilus/preferences/default-folder-viewer"
        value: "'list-view'"
    - name: Files search viewer
      dconf:
        key: "/org/gnome/nautilus/preferences/search-view"
        value: "'list-view'"
    - name: Hide terminal menubar
      dconf:
        key: "/org/gnome/terminal/legacy/default-show-menubar"
        value: "false"
    - name: Disable terminal bell
      dconf:
        key: "/org/gnome/terminal/legacy/profiles:/:b1dcc9dd-5262-4d8d-a863-c897e6d979b9/audible-bell"
        value: "false"
    - name: Set favorite apps in shell
      dconf:
        key: "/org/gnome/shell/favorite-apps"
        value: "['firefox.desktop', 'org.gnome.Evolution.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop', 'xournal.desktop', 'keepass.desktop']"

    # .vim repo must not be present for this to work
    - name: Clone .vim repository
      git:
        clone: yes
        dest: ~/.vim
        repo: https://github.com/Linus4/vim.git
        track_submodules: yes
    - name: Create Symlink to .vim/.vimrc
      file: 
        src: ~/.vim/.vimrc
        dest: ~/.vimrc
        state: link
    - name: Get tmux config
      get_url:
        url: "https://raw.githubusercontent.com/Linus4/misc/master/.tmux.conf"
        dest: "~/.tmux.conf"
    - name: Get ghci config
      get_url:
        url: "https://raw.githubusercontent.com/Linus4/misc/master/.ghci"
        dest: "~/.ghci"
